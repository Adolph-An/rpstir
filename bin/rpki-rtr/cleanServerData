#!/bin/sh
# clean the rpki-rtr data out of the database

# set environment variables if not set
THIS_SCRIPT_DIR=$(dirname $0)
. $THIS_SCRIPT_DIR/../../etc/envir.setup

. $THIS_SCRIPT_DIR/../../lib/util/shell_utils


usage () {
    echo >&2 "Usage: $0 <option>"
    echo >&2 "    -h | --help     Print this help message."
    echo >&2
    echo >&2 "    -f | --force    Clear all rpki-rtr data. Note that this will"
    echo >&2 "                    disconnect all rpki-rtr clients and"
    echo >&2 "                    invalidate the current rpki-rtr session."
}

if test $# -ne 1; then
   usage_fatal "Please specify exactly one argument."
fi

case "$1" in
    -h | --help)
        usage
        exit 0
        ;;

    -f | --force)
        ;;

    *)
        usage_fatal "Unrecognized option: $1"
esac


# Note: the order of these commands is important.

# prevents a new server from starting
echo "TRUNCATE TABLE rtr_session;" | $RPKI_MYSQL_CMD

# makes all queries fail
echo "TRUNCATE TABLE rtr_update;" | $RPKI_MYSQL_CMD

# gets rid of data
echo "TRUNCATE TABLE rtr_full;" | $RPKI_MYSQL_CMD
echo "TRUNCATE TABLE rtr_incremental;" | $RPKI_MYSQL_CMD
