# Run the server side of the RPKI-RTR test
# Note that you should have the loader started before running this
#   and be prepared to run testClient right after starting this script
# The important output will be that from the testClient program

echo ""
echo "Initializing database"
$RPKI_ROOT/run_scripts/initDB.sh
echo "Sleeping 20 seconds, start testClient now"
sleep 20
echo "Loading first set of data"
$RPKI_ROOT/proto/rcli -y -F $RPKI_ROOT/testcases\/C.cer
$RPKI_ROOT/rsync_aur/rsync_aur -s -t $RPKI_PORT -f $RPKI_ROOT/server/testlog.1 -d $RPKI_ROOT/testcases
$RPKI_ROOT/server/doUpdate $RPKI_ROOT/server/testSpecs
echo "Sleeping 10 seconds"
sleep 10
echo "Loading second set of data"
$RPKI_ROOT/rsync_aur/rsync_aur -s -t $RPKI_PORT -f $RPKI_ROOT/server/testlog.2 -d $RPKI_ROOT/testcases
$RPKI_ROOT/server/doUpdate $RPKI_ROOT/server/testSpecs
echo "Sleeping 10 seconds"
sleep 10
echo "Loading third set of data"
$RPKI_ROOT/rsync_aur/rsync_aur -s -t $RPKI_PORT -f $RPKI_ROOT/server/testlog.3 -d $RPKI_ROOT/testcases
$RPKI_ROOT/server/doUpdate $RPKI_ROOT/server/testSpecs

