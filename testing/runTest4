#!/bin/sh

# set environment variables if not set
THIS_SCRIPT_DIR=$(dirname $0)
. $THIS_SCRIPT_DIR/../envir.setup

# run test 4
# checks: deletion of cert propagating invalidating, and adding propagates

echo ""
echo "Running test 4"
$RPKI_ROOT/rsync_aur/rsync_aur -s -t $RPKI_PORT -f $RPKI_ROOT/testing/testDelete -d $RPKI_ROOT/testing/REPOSITORY
echo "Should be 4 entries (not validating):"
$RPKI_ROOT/proto/query -t cert -d ski
echo "Should be 0 entries (validating):"
$RPKI_ROOT/proto/query -t cert -d ski -v
$RPKI_ROOT/rsync_aur/rsync_aur -s -t $RPKI_PORT -f $RPKI_ROOT/testing/testAdd2 -d $RPKI_ROOT/testing/REPOSITORY
echo "Should be 5 entries (not validating):"
$RPKI_ROOT/proto/query -t cert -d ski
echo "Should be 5 entries (validating):"
$RPKI_ROOT/proto/query -t cert -d ski -v
