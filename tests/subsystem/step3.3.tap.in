#!@SHELL_BASH@

@SETUP_ENVIRONMENT@

t4s_setup

@trap_errors@

actual=$(@MKTEMP@) || t4s_bailout "unable to create temporary file"
expected_lines=11

t4s_testcase "(RPKIAllowStaleManifest yes) roa query" '
    use_config_file "$TESTS_SRCDIR/specs.1.3.conf"
    query -t roa -d filename >${actual} || t4s_fatal "roa query failed"
'
t4s_testcase "(RPKIAllowStaleManifest yes) roa query output" '
    lines=$(wc -l <${actual})
    [ "${lines}" -eq "${expected_lines}" ] \
        || t4s_fatal "${lines} != ${expected_lines}"
'

t4s_testcase "(RPKIAllowStaleManifest yes) gbr query" '
    use_config_file "$TESTS_SRCDIR/specs.1.3.conf"
    query -t gbr -d filename >${actual} || t4s_fatal "gbr query failed"
'
t4s_testcase "(RPKIAllowStaleManifest yes) gbr query output" '
    lines=$(wc -l <${actual})
    [ "${lines}" -eq "${expected_lines}" ] \
        || t4s_fatal "${lines} != ${expected_lines}"
'

expected_lines=11

t4s_testcase "(RPKIAllowStaleManifest no) roa query" '
    use_config_file "$TESTS_SRCDIR/specs.3.3b.conf"
    query -t roa -d filename >${actual} || t4s_fatal "roa query failed"
'
t4s_testcase "(RPKIAllowStaleManifest no) roa query output" '
    lines=$(wc -l <${actual})
    [ "${lines}" -eq "${expected_lines}" ] \
        || t4s_fatal "${lines} != ${expected_lines}"
'

t4s_testcase "(RPKIAllowStaleManifest no) gbr query" '
    use_config_file "$TESTS_SRCDIR/specs.3.3b.conf"
    query -t gbr -d filename >${actual} || t4s_fatal "gbr query failed"
'
t4s_testcase "(RPKIAllowStaleManifest no) gbr query output" '
    lines=$(wc -l <${actual})
    [ "${lines}" -eq "${expected_lines}" ] \
        || t4s_fatal "${lines} != ${expected_lines}"
'

t4s_done
