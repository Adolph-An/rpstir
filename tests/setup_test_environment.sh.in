#!/bin/sh -e

export TESTS_TOP_BUILDDIR="@abs_top_builddir@"
export TESTS_TOP_SRCDIR="@abs_top_srcdir@"
export TESTS_INCLUDE_CONFIG="$TESTS_TOP_SRCDIR/tests/test.conf"

. "$TESTS_TOP_BUILDDIR/tests/test.include"

use_config_file "$TESTS_TOP_SRCDIR/tests/test.conf"

PROG="$1"
shift

export TESTS_BUILDDIR="$TESTS_TOP_BUILDDIR"/`dirname "$PROG"`
export TESTS_SRCDIR="$TESTS_TOP_SRCDIR"/`dirname "$PROG"`

case "$PROG" in
    *.sh)
        "$PROG" "$@" || exit $?
        ;;

    *)
        test -n "$TEST_LOG_NAME" || TEST_LOG_NAME=check
        test -n "$TEST_LOG_DIR" || TEST_LOG_DIR=`dirname "$PROG"`
        test -n "$STRICT_CHECKS" || STRICT_CHECKS=1
        run `basename "$PROG"` "$PROG" "$@" || exit $?
        ;;
esac
